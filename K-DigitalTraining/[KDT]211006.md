[docker 설치]  
$ docker –version   

$ sudo apt update  

[docker를 설치하기위한 필수 구성요소 설치]  
$ sudo apt install apt-transport-https ca-certificates curl gnupg lsb-release  
$ curl -fsSL http://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg  

$ ls –al /usr/share/keyrings/ 를 통해 key가 잘 다운 받아졌는지 확인  

$ echo "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu/ $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null  

ubuntu 버전에 크게 신경쓰지 않아도 됨 release <<  
20.04를 썼기 때문에 focal을 가져오겠다는걸 확인할 수 있음  
$ cat /etc/apt/sources.list.d/docker.list 로 확인  

$ sudo apt update  
*무조건 최신버전은 쓰지 않음. 안정화된 버전을 사용함!*  

docker 설치되어 있는지 확인   
$ docker --version    
$ sudo apt list | grep docker-ce    
 

$ sudo apt install docker-ce docker-ce-cli containerd.io    
$ sudo docker version 으로 설치 확인  

$sudo systemctl status docker  

sudo systemctl enable status docker <- 부팅시 자동 시작   


===========================================================


[docker flask (game 처리)]  


sudo vi app.py  

from flask import Flask
app = Flask(__name__)

@app.route('/hello')
def main():
        return 'Hello Game API World!'

if __name__ == '__main__':
        app.run(host="0.0.0.0", port=9999, debug=True)

---------------------------------------------------------------

sudo vi Dockerfile

FROM python:3.8-slim

COPY . /app

RUN pip3 install flask

WORKDIR /app

CMD ["python3", "app.py"]


----------------------------------------------------------------


sudo docker build -t gamelogic .

sudo docker run -d --name=gamelogic -p 9999:9999 gamelogic

sudo docker update --restart=always gamelogic



================================================================




[docker nginx (game ui)]

sudo vi Dockerfile

FROM ubuntu:20.04
RUN apt update
RUN apt install -y nginx

WORKDIR /etc/nginx

COPY default.conf /etc/nginx/conf.d/default.conf

CMD ["nginx", "-g", "daemon off;"]

EXPOSE 8081



------------------------------------------------------------


sudo vi default.conf
 server {
        listen 8081;
        server_name game.surisuridongdong.tk;	//도메인(edge-game ui 연결하는 NLB값)

        location /logic {
                proxy_pass http://game-logic-nlb-9ad13b1c4d2f2f25.elb.ap-southeast-1.amazonaws.com:9999/logic;
        }
}


--------------------------------------------------------------


sudo docker build -t gameui .
sudo docker run -d --name=gameui -p 8081:8081 gameui
(sudo docker run -d --name=gameui -p 8081:80 nginx:latest)
sudo docker update --restart=always gameui

