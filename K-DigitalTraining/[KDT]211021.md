퍼블릭 서브넷 2개 (가용영역 다르게하기 => ALB를 쓰기 위해)   

- NAT용 (내부의 EC2들이 나가게끔)   

- IGW용 - WEB (Nginx 구성)  

nginx가있는 서브넷을 배스천호스트라고 생각하고 서브넷을 하나 더만든다  

ㄴ배스천호스트 : 80막고 본인 ip대역만 허용

퍼블릭 서브넷 세개

첫번째 서브넷은 프라이빗서브넷이 밖으로 나간느용

두번째는 베스천호스트 - 내 ip만 접속, 22번 포트만 접속하게끔 나머지는 불가

세번째는 web서버 80포트

베스천 호스트에서 내부(was)는 얼마든지 붙어도 상관 x  

베스천호스트 서브넷에서 L4스위치 통해 로드밸런서 -> was랑 연결

최소1 시작1 최대 2 해서 L4스위치(nlb) 연결  

L4스위치가 오토스케일링이 아닌데 연결할 수 있는지 없는지 확인(한개의 가상머신과 연결할 수 있는지)  

연결할수 있다고해도 오토스케일링으로 만들어서 연결할 것  

이후 L4스위치 삭제하고 alb로 바꿈  

라우팅 테이블 : 범위 / NACL : 경로  

NetworkFirewall 구성

방화벽 5tuple 비상태저장으로(상태비저장도 상태저장처럼하면됨)

80외에 다른포트 다막기 - nginx 화면이 떠야 함 / but 22번 포트를 막아놨기 때문에 베스천호스트로 22번포트 접속안되는 것 확인 - 그 후 22번 포트 내ip로만 열어놓기 - 그 후 80포트 닫아볼 것(nacl이 아닌 퍼블릭서브넷 앞단에 있는 방화벽으로 막아버리는 실습) - 굳이 nacl하지 않아도됨

80포트로 들어오는것 막고(엔진엑스 안떠야함) 클라우드 워치, 클라우드 트레일로 어떤 ip에서 들어오는지 확인  

비상태 저장 - 80포트 : TCP 항목 선택, 통과/삭제 이용 - Nginx 화면, 22 port bestion host 접속 확인  

상태 저장 - 5tuple - 80포트 : TCP 항목 선택, 통과/삭제 이용 - Nginx 화면, 22 port bestion host 접속 확인  