## VPC 생성


## Subnet 생성


## 인터넷 게이트웨이 - VPC 연결


## 라우팅 테이블 - 명시적 서브넷 연결(edge) - 라우팅(0.0.0.0/0, igw-내 게이트웨이)


## NACL


edge -> 0.0.0.0 / web -> edge / was -> web / db -> was  

## 보안그룹


edge -> 0.0.0.0 / web -> edge / was -> web / db -> was 

## EC2  


## 탄력적 IP 주소 할당 및 연결


## 인스턴스 연결(nginx)

`sudo apt update`

`sudo apt install nginx`

`cd /etc/nginx/sites-available/`

`sudo vi myset.conf`


`sudo ln -s /etc/niginx/sites-available/myset.conf /etc/nginx/sites-enabled/`

`sudo systemctl enable nginx` # 시스템 시작시 자동으로 실행

`sudo service nginx restart`

nginx 퍼블릭 ip 로 접속


##alb 간단하게 만들기


## nginx인스턴스 ami 이미지 생성


## 시작템플릿 생성


보안그룹은 web으로 연결

## auto scaling group


##타겟그룹에서 연결


## alb dualstack주소로 확인해보자

WA! 성공

## 내 도메인도 가능할까..?

오래걸릴수도 있으니 여기서 종료  


- NACL과 AWS에서 실습 시 충돌하는 점 이해


서브넷 마스크 == 같은 반 결정

192.168.35.2 == 나

255.255.255.0 == 반 결정할 때 필요한 도구?

------------------------------------------------

& 연산을 하면 그게 반!


255.255.255.0

11111111 . 11111111 . 111111111 . 00000000

&   192         . 168        .  35           .  2

_______________________________________________________

192          . 168       .  35           .  0    == 반 같은 반

 

나는 192.168.35반의 2번 학생이다

 

10.0.0.0/24 == 255.255.255.0

  ㄴ 반을 찾기 위해서

11111111 . 11111111 . 111111111 . 00000000

&   10          . 0            .  0             .  0

_______________________________________________________

반:     10          . 0           .  0              .  0  

같은 반  
다른 애들이 아니다  
--> and 연산 함 -> 0 & 1 = 0이 되어버림 -> 결과적으로 같은 반이됨

 
원래는 보안그룹도 web->edge, was->web, db ->was로 가게 해야함

NACL = 서브넷에 대한 접근권한 (와이파이 보안/네트워크 방화벽 규칙)

보안그룹 = 각 인스턴스에 대한 접근권한 (내 컴퓨터 보안/운영체제 방화벽 규칙)

-----------------------------------------------------------------------------------------------

# WAS - Flask

`sudo apt update`  

`sudo apt install pip`

`pip install Flask`  

`sudo vi was.py`


`sudo vi start.py`

sleep 30 - 30초의 대기시간을 기다리겠다는 뜻

was.py 파일을 자동실행목록에 추가


`crontab -e`

Ctrl+C 하고 엔터 / 혹은 그냥 엔터

나노에디터로 들어옴

`@reboot python3 start.py`

ctrl x -> 저장할거냐? y -> 엔터 엔터

putty 종료 - ec2 flask 인스턴스 재부팅 -> 퍼블릭ip 복사 후 접속시도


AMI 이미지 생성


AutoScaling 그룹


대상그룹 생성 후 auto scaling그룹에 연결

nlb도 생성


5001번 healthy가 뜹니다..!

NACL, SG 설정해줬는데도 HEALTHY가 정상적으로 뜹니다 성공!

인줄알았는데 대상그룹 취소하고 다시 등록하니 unhealthy,,

->보안그룹에서 vpc영역으로 가는 healthcheck용 포트를 따로 열어줘야 한다 10.0.0.0/16

nlb가 vpc안에 있는데 정확히 어디있는지는 몰라서 vpc전체 영역을 선택

기존은 웹에서 오는 5001번포트만 허용 - 웹에서 오는 요청만 ~

WAS 보안그룹 입장에서는 외부에 어디있는지 모를 대상그룹으로부터 5001번포트로 헬스체크를 요청받기 때문에 어딨는지는 모르지만 vpc안에 있는것은 확실해서 vpc로 보내면 헬스체크도 되고, 요구사항에도 부합하는 규칙이 된다.

- NACL 설정

- 보안그룹 설정
